## #1 概述
-  抽象思维
	- 理解操作系统工作原理的最好方法是抽象思维
	- 比如“一辆车在路上行驶”。将这抽象为三个部分：汽车、道路、驾驶操作，这样可以将复杂的问题分解
	- 软件开发人员运用抽象思维来开发操作系统和应用程序，使得可以不用太关心需要使用的组件的内部结构，而是关心用到哪些组件，以及如何使用
- 分层（由上而下）
	- 用户进程
		- 在用户模式中运行（user mode）
			- 用户空间
				- 用户进程能够访问的空间
				- 崩溃后能被内核清理掉
	- Linux内核
		- 操作系统的核心，运行在内存中的软件
		- 在内核模式中运行（kernel mode）
			- 可以不受限地访问CPU和内存
			- 内核空间：只有内核可以访问的空间
	- 硬件层
		- 包括了内存和CPU、硬盘和网络接口等
- 内核对进程的管理
	- 决定哪个进程可以使用CPU
	- 为进程分配并确保每个进程只能使用自己的内存区块
	- 管理进程间的共享内存及空闲内存
	- 操控硬件设备，避免用户进程直接操纵硬件
	- 提供系统调用和系统支持


## #2 基础命令
#### 基础工具
- shell
	- 标准输入输出
		- `<`
			- 输入重定向，用处不大
		- `>`
			- 输出重定向
			- 如果文件不存在，则新建
			- 如果文件已存在，则默认覆盖
		- `>>`
			- 输出重定向但不会覆盖原文件，而是将输出结果加入到文件末尾
		- `|`
			- 管道字符
			- 将一个命令的执行结果输出到另一个命令
	- 标准错误输出
		- `2>`
			- `1>`是标准输出，`2>`是错误输出
			- 指定了当出现错误时，错误输出的位置
			- `ls /ffff > 文件a 2> 文件b`
		- `2>&1`
			- 标准输出和错误输出到同一个文件
			- `ls /ffff > 文件a 2>&1`
- 命令行编辑
	- 使用左右箭头来编辑命令行
	- 使用上下箭头来查看之前的命令
	- 使用`ctrl+..`指令进行便捷操作
		- `ctrl+W`：删除前一个词
		- `ctrl+U/K`：删除至行首/行尾的内容
- 文本编辑器
	- Unix提供两个标准编辑器：Emacs和vi
- 帮助手册
	- `man+需要查询的命令`或`需要查询的命令 --help`或`info+需要查询的命令`
		- 直接查询
	- `man -k 关键字`
		- 只知道某个功能，但不知道命令名时，可以通过关键字来查找
	- 章节列表
		- 在线帮助手册具有章节列表
		- `man 5 passwd`
		- 按章节序号搜索可以细化结果
| 章节 | 简介                       |
| ---- | -------------------------- |
| 1    | 用户命令                   |
| 2    | 系统调用                   |
| 3    | Unix高级编程库文档         |
| 4    | 设备接口和设备驱动程序信息 |
| 5    | 文件描述符                 |
| 6    | 游戏                       |
| 7    | 文件格式、规范和编码       |
| 8    | 系统命令和服务器           |

#### 基础命令
- 基础命令
	- cat
		- 在shell中显示一个或多个文件的内容
		- 实现标准输入输出
	- ls
		- 显示指定目录的内容
		- `-l`：显示详细列表
		- `-F`：显示文件类型信息
	- mv和cp
		- 剪切/复制文件
		- `$cp file1 file2`
			- 从file1复制到file2
		- `$cp file1 ... fileN dir`
			- 将多个文件复制到目录dir
	- touch
		- 创建文件
		- 如果文件已存在，则更新时间戳
	- rm
		- 删除文件
		- `-r`递归删除目录下的所有文件（recursive）
		- `-f`表示强制删除
	- echo
		- 将该命令的参数显示到标准输出
- 浏览目录
	- 目录结构
		- 目录结构从`/`开始，称为root目录
		- `.`表示当前目录
		- `..`表示上一层目录
		- 不以`/`开头的路径称为相对路径
	- cd
		- 设置当前工作目录
	- mkdir
		- 创建新目录
	- rmdir
		- 只能删除空目录
	- shell通配符
		- `*`匹配任意字符
			- 反义使用`'*'`
		- `?`匹配一个字符
- 中间命令
	- grep
		- 显示文件和输入流中的参数匹配的行
		- 支持正则表达式
			- `.`匹配任意一个字符
			- `.*`匹配任意字符
		- `grep root /etc/passwd`
			- 显示文件/etc/passwd中包含“root”的所有行
		- `grep root /etc/*`
			- 显示目录/etc中所有包含root的文件
		- `-i`：不区分大小写
		- `-v`：反转匹配（显示不匹配的行）
	- less
		- 当要查看的文件过大时，less命令可以将文件分屏显示
			- `空格键`：下一屏
			- `B键`：上一篇
			- `Q键`：退出
		- less命令是more命令的增强版
	- pwd
		- 输出当前工作目录名
	- diff
		- 查看两个文件之间的不同
	- file
		- 查看一个文件的格式信息
	- find和locate
		- 查找文件所在的目录
		- locate会在系统创建的文件索引中查找文件，查找速度更快，但是对于未被加入索引的新文件可能会无能为力
	- head和tail
		- 显示文件前/后10行内容
		- `head -5 /etc/passwd`
			- 数字为显示的行数
	- sort
		- 将文件内所有行按照字母顺序快速排序
- 更改密码
	- passwd
		- 需要输入一遍旧密码和两遍新密码
- 进程命令
	- 进程属性
		- PID
		- TTY
			- 进程所在的终端设备
		- STAT
			- 进程再内存中的状态
		- TIME
			- 进程目前为止所用CPU时长
		- COMMAND
			- 命令名
	- ps
		- `x`：（`ps x`）显示当前和用户运行的所有进程
		- `a`：显示所有进程
		- `u`：显示详细信息
		- `w`：显示命令的全名，而非显示一行以内的内容
	- kill
		- 请求内核发送一个信号给进程
		- 信号种类可选，而默认是TERM（terminate）
			- STOP：（`kill -STOP pid`）请求暂停
			- CONT：请求继续执行
			- INT：等效于`ctrl+C`，终止当前运行的进程
			- KILL：强行终止进程，并将其移出内存，不会给进程清理和收尾的机会
			- 每个信号对应一个数字
	- 任务控制
		- 向进程发送TSTP（类似STOP）和CONT信号的方式
		- 使用`strl+Z`发送TSTP信号，然后键入fg或bg（将进程置于前台/后台）继续运行程序
		- 使用jobs命令查看暂停了哪些进程
	- 后台进程
		- 在shell上执行命令时，命令行提示符会暂时消失，直到命令结束时。可以使用&操作符将进程设置为后台运行，使得提示符一直存在，即使退出系统
- 文件模式和权限
	- 文件模式诸如`-rw-r--r--`
		- 文件类型：第一个字符
			- `-`常规文件
			- `d`目录
			- `l`符号链接，即快捷方式
		- 权限信息
			- 依次是用户、用户组、其他用户的权限信息，各3位
			- `r`可读
			- `w`可写
			- `x`可执行
			- `-`无权限
			- 可以使用数字表示权限信息，转换方式每3位中，有权限则视为1，并将2进制转十进制
	- chmod
		- 更改文件权限
		- `chmod g+r file`
			- 为用户组加上可读权限
			- 其他用户使用`o`
			- 可以多选`go`
			- 取消权限使用`go-r`
		- `chmod 777 file`
			- 设置所有的权限位
	- umask
		- 设置默认权限
		- `umask 777`
	- ln
		- 创建符号链接
		- `ln -s target linkname`
			- 没有`-s`时，表示创建一个硬链接
- 压缩文件
	- gz格式
		- gz
			- 压缩单个文件
		- gunzip
			- 解压缩gz文件
	- tar格式
		- 归档：多个文件合并为一个
		- `tar cvf archive.tar file1 file2 ...`
			- 压缩多个文件
		- `tar xvf archive.tar`
			- 解压缩
	- tar.gz格式（tgz格式）
		- `tar zxf file.tar.gz`
			- 解压缩
	- tar命令常用参数
		- c：创建文件
		- t：预览压缩包内容
		- x：解压模式
		- k：解压遇到已经存在的文件时，不要覆盖
		- f：表示指定归档文件名
		- z：运行gunzip
		- v：显示详细的命令执行信息
	- bz2格式
		- 使用bzip2压缩、bunzip2解压缩
	- xz格式
		- 使用xz压缩，unxz解压缩
	- zip格式
		- 使用zip压缩，unzip解压缩


#### 特性
- dot文件
	- 以`.`开头的文件是隐藏文件
	- 使用`ls -a`可见
- 变量
	- shell变量
		- 只能被当前的shell访问
	- 环境变量
		- 能被shell中运行的所有进程访问
		- 通过export命令将shell变量设置为环境变量
	- 命令路径PATH
		- 特殊的环境变量，定义了命令的路径
		- `PATH = dir:$PATH`
			- 将路径dir加入到PATH的最前面
- 目录结构
	- `/bin`
		- 存放可执行文件，包括大部分Unix命令
	- `/dev`
		- 设备文件
	- `/etc`
		- 存放重要的系统配置文件
	- `/home`
		- 用户目录
	- `/lib`
		- 供可执行程序使用的各种代码库，包括静态库和动态库，及辅助文件
	- `/proc`
		- 存放系统相关信息，如当前运行的进程和内核信息
	- `/sys`
		- 类似`/proc`目录，存放设备和系统的信息
	- `/sbin`
		- 存放可执行的系统文件，这些文件用于管理系统
	- `/tmp`
		- 存放临时文件，很多系统会在启动期间清空该目录
	- `/usr`
		- 不存放用户文件，而是Linux的系统文件
		- `/include`
			- 存放C编译器需要使用的头文件
		- `/info`
			- 存放GNU帮助手册
		- `/local`
			- 管理员安装软件的地方
		- `/man`
			- 存放用户手册
		- `/share`
			- 存放Unix系统间的共享文件
	- `/var`
		- 存放运行时信息，比如系统日志、用户信息、缓存和其他信息
		- 该目录下的tmp文件夹内容不会被清除
	- `/boot`
		- 存放内核加载文件
	- `/media`
		- 加载可移除设备的地方
	- `/opt`
		- 存放第三方软件
- 超级用户
	- sudo
		- 以root用户身份执行ml
		- 系统不会允许任何用户都能够以超级用户的身份运行命令，而权限名单在/etc/sudoers中

## #3 设备管理
- 设备文件（设备节点）
	- 通常存放在/dev目录下
	- 设备类型
		- 可以通过`ls -l`的文件模式辨认
		- b
			- 块设备
			- 程序从块设备中按固定的块大小读取数据
			- 如：磁盘
		- c
			- 字符设备
			- 这部分设备用于处理数据流，只能对设备进行读取和写入操作
			- 如：打印机
		- p
			- 管道设备
			- 同样只接受输入输出，但对象是另外一个进程
		- s
			- 套接字设备
			- 用于跨进程通信，常置于/dev目录之外
	- 并不是所有的设备都有对应的设备文件，而内核根据其找到设备的顺序为设备文件命名，每次重启后设备文件名有可能不同
- sysfs设备路径
	- sysfs界面
		- 旨在基于硬件属性统一显示设备的相关信息
		- 位于`/sys/devices`之下
- dd命令
	- 从输入流读取数据然后写入输出流，该过程可能涉及编码转换
	- dd命令的格式选项和大多数Unix命令不同，沿袭了IBM JCL的风格，使用`=`而不是`-`来设定选项和参数值
	- `dd if=/dev/zero of=new_file bs=1024 count=1`
		- 从`/dev/zero`复制大小为1024byte的数据块到文件new_file
		- if：输入文件
		- of：输出文件
		- bs：数据块大小
		- count：复制块的总数
		- skip：跳过一定数量的块后才进行复制操作（偏移）
		- `dev/zero`是一个特殊的字符设备文件，用于产生空数据（无限提供0的文件）
- 设备名
	- sd前缀
		- 大部分硬盘设备都使用sd前缀
		- sd代表SCSI（Small Computer System Interface） disk，其中SCSI是一种广泛应用的通信协议
		- 使用`lsscsi`命令显示SCSI设备信息
	- sr前缀
		- 大部分的CD和DVD
	- hd前缀
		- 老旧设备
	- tty前缀
		- 终端设备，包括shell
		- 负责在用户进程和输入输出设备之间传送字符
- 创建设备文件
	- 在现代Linux系统中，不需要创建自己的设备文件，这项工作由devtmpfs和udev完成
	- mknod命令
		- 创建设备
		- `mknod /dev/sda1 b 8 2`
			- 创建设备`/dev/sda1`
			- 参数分别是设备类型、主要编号（可省）、次要编号（可省）
- 设备管理与udevd
	- Linux系统内核在检测到新设备的时候，向用户空间进程发送消息，称为udevd
	- 用户空间进程会在另一端验证新设备的属性、创建设备文件、执行初始化
	- 系统启动前期也需要设备文件，因此udevd需要在其之前启动


## #4 硬盘和文件系统
#### 分区
- 分区是对磁盘的进一步划分
	- 主分区
		- 磁盘的常规分区
		- MBR最多只能有4个主分区
		- 已经存在4个主分区下仍希望得到更多分区时，需要将一个主分区设置为扩展分区，然后将其划分为多个逻辑分区
	- 扩展分区
	- 逻辑分区
- 分区表
	- MBR（主引导记录Master Boot Record）
	- GPT（全局唯一标识符分区表GUID Partition Table）
- 分区工具parted
	- `parted -l`
		- 查看系统分区表
- 机械硬盘和固态硬盘
	- 机械硬盘
		- CHS构造（柱面-读写头-扇区）
		- 支持逻辑块寻址LBA
	- 固态硬盘SSD
		- 分区布局是影响SSD性能的一个方面
			- SSD通常读取4096byte数据，如果要读取的数据没有在同一区块内，就需要两次读取操作
			- 磁盘起始位置应该尽量是4096的整数倍

#### 文件系统
- 常用Linux文件系统类型
	- ext4
	- iso9660
	- FAT
- 创建文件系统
	- 使用mkfs命令
	- `mkfs -t ext4 /dev/sdf2`
- 挂载文件系统
	- `mount`
		- 查看当前文件系统状态
		- 每一行对应一个已挂载的文件系统，信息包含了设备名、挂载点、文件系统类型，包括了一些虚拟设备
	- `mount -t ext4 /dev/sdf2 /home/extra`
		- 将`/dev/sdf2`设备挂载到`/home/extra`
		- `-t`：指定文件系统类型
		- `-r`：以只读模式挂载
		- `-n`：重新挂载
	- `unmount 挂载点`
		- 卸载文件系统
- df命令
	- 查看文件系统的容量和使用量
- du命令
	- 查看哪些文件占用了大量空间
- fsck命令
	- 检查文件系统的工具
	- 不可以在一个已经挂载的文件系统上使用fsck，可能导致系统崩溃和文件损坏
- 文件系统UUID
- 磁盘缓冲、缓存和文件系统
- 交换空间
- 磁盘和用户空间
- 深入传统文件系统


## #5 Linux内核的启动
#### Linux内核启动
- Linux启动过程
	- 加载并运行引导装载程序
		- 由BIOS或者固件加载并运行
	- 引导装载程序在磁盘上找到内核映像，并将其载入内存并启动
	- 内核初始化设备及其驱动程序
	- 内核挂载root文件系统
	- 内核使用PID 1来运行一个叫init的程序，用户空间在此时开启
	- init启动其他的系统进程
	- init启动一个负责用户登录的进程
- 启动消息
	- 通过内核系统日志文件查看
		- 通常位于`/var/log/kern.org`中
	- dmesg命令
- 内核初始化的过程
	- 检查CPU
	- 检查内存
	- 检测设备总线
	- 检测设备
	- 设置附加内核子系统（如网络）
	- 挂载目录
	- 启动用户空间
- 内核参数
	- 引导装载系统会向内核传递一系列文本形式的内核参数来设定内核的启动方式
	- 查看启动参数
		- 位于`/proc/cmdline`文件中
		- root参数
			- 表示root文件系统存放的位置
			- 该参数值是一个设备文件，但是使用UUID的方式表示
- 引导装载程序
	- 功能
		- 从多个内核中选择一个使用
		- 从多个内核参数集中选择一个使用
		- 允许用户配置
		- Linux的内核及其参数都位于root文件系统中
	- 在PC上，引导转载程序一般使用BIOS或UEFI（Unified Extensible Firmware Interface）的方式来访问硬盘
- GRUB（Grand Unified Boot Loader）
	- 最常见的引导转载程序
	- GRUB有自己的命令和内核
	- 使用GRUB命令行
		- ls
			- GRUB能识别的所有设备的列表
		- set
			- 查看已设置的GRUB变量
- MBR和UEFI的启动机制
	- UEFI的推出旨在替代存在诸多限制的BIOS
		- 使用特殊的文件系统：EFI系统分区（ESP）
		- 文件系统内有一个名为efi的目录，每个引导旨在程序有自己的标识符和一个对应的目录，如`efi/microsoft`
		- 启动加载文件后缀为efi
	- GPT是UEFI标准的一部分



#### 引导


## #6 用户空间的启动
#### init



## #7 系统配置


## #8 进程与资源利用


## #9 网络与配置


## #10 网络应用与服务


## #11 shell脚本


## #12 在网络上传输文件


## #13 用户环境


## #14 Linux桌面


## #15 开发工具


## #16 从C代码编译出软件


## #17 在基础上搭建